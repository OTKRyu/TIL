# 블록체인과 설계

 ## 어떤 체인을 사용할 것인가?

- 이더리움
  - pulic chain은 누구나 접근 가능, 진정한 의미의 탈중앙화
  - 다만 데이터 저장이 비싸고 transaction이 발생할 때마다 비용 지불
  - 다소 복잡한 smart contract 배포
- 하이퍼렛저 파브릭
  - db에 준하는 빠른 속도
  - 사전에 약속된 사용자만 참가 가능
  - 사용자가 인지할 수 없는 사이에 블록체인 활용 가능

## 전체 구조

frontend - backend - application binary interface(abi) - blockchain network

- frontend
  - 메타마스크
  - 쉽게 사용할 수 있는 크롬 익스텐션
  - key를 보관하고 서명을 안전하게 하는 역할을 한다
  - web3를 이용해서 쉽게 서명할 수 있다.
  - 개발자는 추상화된 api를 이용해서 쉽게 개발 가능
  - web3.js를 이용
  - 직접 private key를 이용해서 서명하는 것도 가능하지만 메타마스크와 같은 서비스를 이용하는 것이 안전
  - 다른 사람의 지갑 주소로 ETH를 받아오거나 smart contract과 통신해서 데이터 받아오기도 가능
- abi
  - application binary interface
  - binary 형태로 컴파일된 smart contract와의 통신 interface
  - 원래는 binary형태지만 human readable한 상태로 볼 수 있다.

## 블록체인의 특성

- payable modifier
  - 이더리움에 깔려있는 전제는 이더리움의 가치는 화폐의 가치 즉, 결제를 통해 발생
  - 이더리움이 스마트 컨트랙에 입금될 때의 로직을 만들고 싶다면 payaable modifier를 붙여준다면 구현 가능하다.
  - 모임 통장 만들기, 경매, 안전 거래 등등 대부분의 핵심 로직은 payable modifier를 통해 구현한다.
- 블록체인에 영상을 저장하려면
  - 이더리움의 블록 크기는 1~8mb
  - 텍스트 데이터도 200개이상 저장하는 것도 어렵다.
  - 즉 영상 자체를 저장하는 것보다 영상의 해시값을 체인에 저장해놓는다면 위변조는 막을 수 있다. 해시함수로는 md5같은 것들을 사용한다.
- 이더리움 vs 자체코인
  - 화폐의 가치는 신용도에 따라 결정된다.
  - 이더리움의 경우 많은 사람이 사용하기에 신용도도 높고 가치도 높다.
  - 하지만 자체코인의 경우 자유도야 높지만 신용도가 낮을 것이다.
- wrapper class
  - web3j를 이용해서 smart contract와 통신하기 위해서는 wrapper class를 생성해야함
  - 다만 compile된 binary가 조금이라도 변경한다면 wrapper class를 갱신해야함
  - jenkins와 같은 자동화된 빌드 도구를 사용하는 것이 좋은 방법
- 유저가 블록체인을 불편해할 때
  - 서비스 제공자가 사용자 별로 키를 보관 및 관리 가능
  - 신규 유저가 생기면 지갑을 생성하고 보관
  - 로그인 인증을 통해서 유저를 확인하고 대신 서명을 한다.
  - 유저들은 블록체인의 구조나 작동원리에 관심이 없기 때문에 이런 방식을 많이 사용한다.
- 프론트엔드 vs 백엔드 어디서 처리할 것인가
  - 탈중앙화를 원한다면 프론트에서 유저가 서명하는 것이 맞음
  - 다만 유저는 블록체인에 익숙하지 않기때문에 백엔드에서 대리 서명하는 것도 방법
  - 기획 때 결정해놓는 것이 중요하다
- 어떤 네트워크를 사용할 것인가
  - private network를 구성한 것
  - infura와 같은 public하게 구성된 테스트넷들도 많이 있다.
  - 실제로 이더리움 메인넷과 동일한 환경인 테스트넷을 사용하는 것도 가능
  - 다만 실 서비스를 생각한다면 이더리움 메인넷에 배포를 해야할 것이다. 물론 돈이 든다.
- public network를 쓸 때의 장점
  - 모든 정보를 공개하기 때문에 어떤 식으로 작동했는지 로그를 살펴볼 수 있거나 디버깅을 해볼 수 있다.