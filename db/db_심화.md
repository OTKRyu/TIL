# db

공통 코드 테이블

- 서비스 내에는 분류 기준들이 존재
- 서비스 별로 많은 양의 기준 정보가 존재
- 기준 정보를 모아 하나의 테이블에서 관리

mysql workbench에서 쿼리문을 실행하는 화면에서 설명 버튼을 누르면 실제 작동원리를 시각화해서 보여준다.

pk가 있을 경우 자동으로 인덱스를 적용해서 모든 로우을 찾지않고 해당값을 찾지만, pk가 없을 경우는 기본적으로 모든 로우를 찾아다니며 결과를 도출한다.

pk가 없더라도 조건을 적절히 주면 인덱스를 적용해서 찾아올 수 있다.

db가 커지면 모든 로우를 도는 것과 특정 로우만 찾는 것의 차이가 커지므로 신경써야한다. 조인을 할 때도 조건을 하나씩 걸어주는 것이 모든 로우를 도는 것을 막아줄 수 있다.

이런 것들 중 신경써야할 것이 어떤 테이블을 먼저 조회할 것이냐를 따지는 거도 중요해진다. `/*+ JOIN_PREFIX(TABLE_NAME)\*/` 를 select 뒤에 써주면 된다.

추가적으로 백엔드 서버와 db사이의 통신도 중개해주는 connection pool이 있는데 이것도 기본적인 설정이 최적화되어 있다고 확신할 수 없다. 고로 서비스가 커지면 체크를 해봐야할 필요가 있다.

## tip

- 탭 두번으로 조건마다 8번 띄워놓으면 보기 편하다.
- 특히 서브쿼리를 써야할 때 이런식으로 인덴트를 넣지 않으면 가독성이 크게 떨어진다.
- 별 조건이 없더라도 where 1=1 넣어주면 다른 조건을 넣을 때 조금 더 편하게 넣을 수 있다.
  - 다만 db의 처리방식이 다 다르기 때문에, where 1=1조건을 주는 것이 풀 스캔을 돌 수도 있기 때문에, 한번정도는 테스트해봐야한다.
- 쿼리짤 때 explain 한번씩 보면서 풀 스캔은 피할 수 있도록 노력하자
- 조인할때도 데이터가 적은 쪽부터 하는 쪽이 좋다. driving table이 데이터가 적은 테이블, drived table이 데이터가 많은 테이블