# deploy

## 배포 구조

- 깃랩(배포)
- 젠킨스(배포)

- 브라우저
- 포트 80, 443
- nginx
- /, /api
- 백엔드, 프론트 엔드(도커)

## nginx

- high performance load balancer, web server, api gateway, reverse proxy
- 비동기 방식이기 때문에 높은 서능
- 정적인 파일일때 특히 톰캣보다 좋은 성능
- load balancer나 api gateway로 많이 활용

## 분기

- /로 들어오면 프론트엔드
- /api로 들어오면 백엔드

## 도커를 쓰는 이유

- 빠르게 서버 증설 가능
- 운영체제를 쓰는 것보다 빠름
- 이미지를 만들어두면 찍어내기만 하면 되는 배포의 편의성

## 어디까지 도커화 해야할까

- fe,be는 필수적, 배포의 효율성 및 편의성 고려
- db, jenkins, nginx는 선택
- db를 새로 배포할 일이 있을까? 데이터는? 빌드 서버를 병렬적으로 추가 증설할 일이 있나?

## 임의의 포트를 쓰면 안 되는 이유

- ISP에 따라서 닫혀 있는 포트가 존재
- 어느 곳은 되고, 어느 곳은 안 될 수도 있다
- 고객은 이런거 신경안쓰고 이탈한다.

## jenkins

- 깃랩의 특정 브랜치에 머지하면 이벤트 트리거, 젠킨스 빌드
- 도커를 이용한 빌드 실행
- 동일한 이미지이므로 동일한 작동 확보

## SSL(=> TLS)

- 회원가입 시에 비밀 번호 등의 개인 정보가 전송되고, 수시로 유출되어서는 안 되는 저보들이 오가기 때문에 암호화 필요
- 매번 데이터를 암호화해서 전소하는 것도 어려워서 transport layer security를 쓴다
- 이론적으로는 안전하다

## cert bot

- https 확산을 위한 비영리 프로젝트(let's encrypt)
- 상용 프로그램을 제작할 때는 신뢰할 수 있는 root 인증서 발급자로부터 ssl 인증서를 구매해서 사용한다.
- 다만 중소규모 프로젝트는 cert bot을 이용해 무료 인증서를 발급 받아서 사용하면 좋다
- nginx나 백엔드 서버에 설정이 필요하다.

## awss 사용자 계정 만들기

- 각 프로그램에 적합한 사용자 계정을 생성
- ubuntu 계정이나 root 계정의 경우 해커의 공격이 그 계정의 권한으로 실행, 매우 위험
- 사용자 계정으로 실행하면 그나마 피해를 최소화할 수 있다.